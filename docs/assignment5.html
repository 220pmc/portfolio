<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Pok Man Chung" />

<meta name="date" content="2022-05-29" />

<title>Assignment 5</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="./assignment1a.html">Assignment 1 (Part A)</a>
</li>
<li>
  <a href="./assignment1b.html">Assignment 1 (Part B)</a>
</li>
<li>
  <a href="./assignment2.html">Assignment 2</a>
</li>
<li>
  <a href="./assignment3.html">Assignment 3</a>
</li>
<li>
  <a href="./assignment4.html">Assignment 4</a>
</li>
<li>
  <a href="./assignment5.html">Assignment 5</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Assignment 5</h1>
<h3 class="subtitle">STATS 220 Semester One 2022</h3>
<h4 class="author">Pok Man Chung</h4>
<h4 class="date">2022-05-29</h4>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>I selected 4 different Apple Music top 100 playlists: Brazil, France,
New Zealand and Philippines.</p>
<p>I chose the playlists from these 4 countries because the official
language(s) for each country was not the same.</p>
<p>Official Language(s):</p>
<ul>
<li>Brazil: Portuguese</li>
<li>France: French</li>
<li>New Zealand: English &amp; Maori</li>
<li>Philippines: English &amp; Filipino</li>
</ul>
<p>I would like to explore the differences in terms of the duration of
songs and similarity among these playlists.</p>
<p>In the meantime, I would also like to investigate whether the top 50
songs in each playlist behaved differently to the bottom 50 songs.</p>
<p>For duration, minute has long been accepted as the unit of length for
songs. Therefore, I would compare the difference in median duration (in
minutes) for each playlist and level. I chose median instead of mean
because median would unlikely to be affected by extreme values.</p>
<p>To measure similarity, I would count the number of common songs in
the baseline group and non-baseline group. Since each playlist contains
100 songs, the number of common songs is also the percentage of
similarity. In this study, I chose New Zealand as the baseline
group.</p>
</div>
<div id="visualisation" class="section level2">
<h2>Visualisation</h2>
<p><strong>Duration</strong> <img src="song_vis.png"
alt="Duration_plot" /></p>
<p>From the plot, we can see that the median duration of songs in
different countries are approximately the same as indicated by the brown
triangles. The lowest median duration is approximately 3 mins from
Brazil’s top 100 playlist, whereas the highest median duration is
roughly 3.5 mins from the Philippines’ top 100 playlist.</p>
<p>Also, it seems that the median duration between the top 50 songs and
the bottom 50 songs within each playlist is roughly the same, all with
differences smaller than 0.5 mins.</p>
<p>However, the variability and skewness behaves differently in each
playlist. In France, New Zealand and Philippines, the distributions are
right skewed. But, the variability in Philippines top 100 playlist is
much higher than all other countries and there is one outlier with
duration of more than 10 mins. For Brazil, the distribution is roughly
normally distributed (in both top and bottom 50 songs).</p>
<p>Therefore, for the difference in median duration, based on the
visualisation, there are only slight differences between different
countries. We do not know whether the difference is statistically
significant or not. Also, it seems that the median duration is
independent from whether the song is from the top 50 or the bottom 50
group.</p>
</div>
<div id="data-creation" class="section level2">
<h2>Data Creation</h2>
<p><strong>Similarity</strong> <img src="song_creation.png"
alt="Similarity_plot" /></p>
<p><strong><em>Philippines</em></strong></p>
<p>From the chart, we can see that Philippines’ top 100 playlist is the
most similar playlist to New Zealand’s. The total similarity rate is
28%, with 15% contributed from the bottom 50 songs and 13% contributed
from the top 50 songs. The similarity rate contribution from the bottom
50 songs group is greater than that of the top 50 songs group by 2%.</p>
<p><strong><em>Brazil</em></strong></p>
<p>The similarity rate between Brazil and New Zealand top 100 playlist
is 24%. We cannot see any difference in the proportions between the top
50 songs and bottom 50 songs groups, both of which contribute 12% to
similarity.</p>
<p><strong><em>France</em></strong></p>
<p>Top 100 playlist in France has the least similarity rate, with only
8% in total. We can see that the similarity rate contribution from the
bottom 50 songs group is 6%, whereas the similarity rate contribution
from the top 50 songs group is 2%, showing a 4-percent difference.</p>
<p><strong>Summary</strong></p>
<p>For similarity, there are only slight differences between whether a
song is from the top 50 songs group or not in both Philippines and
Brazil; in France, there is a 4% difference. To determine whether the 4%
difference is statistically significant or not, further investigation
shall be conducted.</p>
<p>The overall similarity of the top 100 playlist from Philippines,
Brazil and France are 28%, 24% and 8%. One possible reason for
Philippines’ top 100 playlist having the highest similarity rate might
be due to the fact that English is one of the official languages in both
Philippines and New Zealand.</p>
<p><strong>Limitations</strong> However, there are limitations in this
study.</p>
<p>Firstly, Apple Music users might use VPN services when they accessed
their accounts. Therefore, the ranking of songs might not truly reflect
the song popularity in that country.</p>
<p>Secondly, the sample is not representative enough. Users of different
streaming platforms might have different preferences in listening to
music. Also, some of the songs might not be provided or available in
certain region due to copyright issues. Therefore, further study should
be conducted.</p>
<p><strong>Used knowledge and techniques from Stats 220</strong></p>
<p>First of all, I used the <code>filter()</code> function to extract
all rows related to New Zealand Top 100 playlist and add a
<code>$</code> to extract the vector of the <code>trackId</code> of the
songs in the playlist.</p>
<p>After that, I used <code>mutate()</code> function to include several
variables in the <code>song_data</code> data frame. To determine whether
a song from other countries’ top 100 playlist is also included in New
Zealand top 100 playlist, I used <code>trackId %in% nz_song_id</code> to
get a vector with <code>TRUE</code> and <code>FALSE</code>. If a song is
in both playlists, it will return TRUE, otherwise FALSE.</p>
<p>Since I also want to separate songs into 2 levels, namely Top 50
songs and Bottom 50 songs, I need to compare whether the rank of a song
is above or below rank 50. However, in the <code>rank</code> variable,
since the numbers are directly extracted from the webpage, they all
belong to the character class, and I cannot make direct comparison with
the value 50. Therefore, I converted the rank number into numeric class
and mutate them in the data frame with variable name:
<code>rank_numberic</code>.</p>
<p>Next, I used the <code>summarise()</code> and <code>group_by()</code>
functions together to get the count of common songs and assign the
summarised data frame to a variable. Therefore, I could use this
summarised data in the ggplot() function when I created the plot.</p>
<p>As ggplot provides a layered grammar of graphics framework, apart
from the base layer and geometry layer, I added labels, title and
captions in order to make the information in the plot to be more
comprehensive. I also change the y-axis scale as the default scale is
not informative enough. And finally, I also changed the bar and panel
colours to best suit the theme in my report.</p>
</div>
<div id="final-reflection" class="section level2">
<h2>Final Reflection</h2>
<p>I think the most important idea I learnt from Module 5 is that we
need to be responsible when we conduct web scraping. Learning the web
scrapping techniques and knowledge is not hard, but we need to be
extremely careful to judge whether we should start web scrapping the
data from the internet. It is because we should ensure that our actions
will not overload the website server or violate terms of a website.
Therefore, we need to follow the websites’ terms and conditions. If they
disallow us from web scrapping, we should not web scrap the data.
Instead, we should contact the owner of the website to ask for
permission.</p>
<p>From these assignments, I understand that in order to well present
ideas to others, apart from having good writing skills, we need to know
how to use codes. By using programming code, we can save a lot of time
in creating different data frames or even visualisations.</p>
<p>Also, we should try integrating skills from different modules. For
example, in previous modules and assignments, we learnt how to deal with
dynamic data. I think the same technique can also apply to web scrapping
since the content in a website will also change from time to time. By
using the inline R code technique, we do not need to update each value
or figure by hand.</p>
<p>I am curious to learn more about using R codes to deal with different
problems. Although codes taught in this course are sufficient to solve
basic problems, I believe that there will be some other codes which are
more efficient. It is because in the real world, data sets are usually
complex and big, we should always look for codes with the lowest time
complexity so that we can solve the problem within reasonable time.</p>
</div>
<div id="code-appendix" class="section level2">
<h2>Code Appendix</h2>
<pre class="r"><code># Invoke libraries
library(&quot;tidyverse&quot;)
library(&quot;rvest&quot;)

# Assign links to variables

france_top_100 &lt;- &quot;https://music.apple.com/us/playlist/top-100-france/pl.6e8cfd81d51042648fa36c9df5236b8d&quot;
new_zealand_top_100 &lt;- &quot;https://music.apple.com/us/playlist/top-100-new-zealand/pl.d8742df90f43402ba5e708eefd6d949a&quot;
brazil_top_100 &lt;- &quot;https://music.apple.com/us/playlist/top-100-brazil/pl.11ac7cc7d09741c5822e8c66e5c7edbb&quot;
philippines_top_100 &lt;- &quot;https://music.apple.com/us/playlist/top-100-philippines/pl.b9eb00f9d195440e8b0bdf19b8db7f34&quot;

links &lt;- c(france_top_100, new_zealand_top_100, brazil_top_100, philippines_top_100)

# Create Data Frame
apple_data &lt;- map_df(c(1:4), function(i){
  
  Sys.sleep(2)
  link &lt;- links[i]
  
  page &lt;- read_html(link)
  
  trackId &lt;- page %&gt;%
    html_elements(&quot;.songs-list&quot;) %&gt;%
    html_elements(&quot;a&quot;) %&gt;%
    html_attr(&quot;href&quot;) %&gt;%
    .[str_detect(., &quot;/song/&quot;)] %&gt;%
    str_remove_all(&quot;https://music.apple.com/us/song/&quot;)
  
  rank &lt;- page %&gt;%
    html_elements(&quot;.songs-list&quot;) %&gt;%
    html_elements(&quot;.songs-list-row__rank&quot;) %&gt;%
    html_text2()

  country_name &lt;- page %&gt;%
    html_elements(&quot;h1&quot;) %&gt;%
    html_text2() %&gt;%
    str_remove_all(&quot;Top 100: &quot;)
  
  return(tibble(country_name,
                trackId,
                rank))
  })

# Save data to RDS
saveRDS(apple_data, &quot;apple_data.rds&quot;)</code></pre>
<pre class="r"><code># Invoke Libraries
library(tidyverse)
library(jsonlite)

# Create apple_data data frame
apple_data &lt;- readRDS(&quot;apple_data.rds&quot;)

trackIds &lt;- apple_data$trackId %&gt;%
  unique() %&gt;%
  na.omit()

# Get data from iTunes API
itunes_data &lt;- map_df(c(1:length(trackIds)), function(i){
  
  Sys.sleep(2)
  song_id &lt;- trackIds[i]
  url &lt;- paste0(&quot;https://itunes.apple.com/lookup?id=&quot;, song_id)
  response &lt;- fromJSON(url)
  itunes_data &lt;- response$results
  })
  
saveRDS(itunes_data, &quot;itunes_data.rds&quot;)</code></pre>
<pre class="r"><code># Invoke library
library(tidyverse)

# Create data frame
apple_data &lt;- readRDS(&quot;apple_data.rds&quot;)
apple_data &lt;- mutate(apple_data, trackId = as.numeric(trackId))

itunes_data &lt;- readRDS(&quot;itunes_data.rds&quot;)

song_data &lt;- left_join(apple_data, itunes_data, by = &quot;trackId&quot;)

# Inspect name of columns
names(song_data)

# Save data
saveRDS(song_data, &quot;song_data.rds&quot;)</code></pre>
<pre class="r"><code># Invoke library
library(tidyverse)
library(ggplot2)

song_data &lt;- readRDS(&quot;song_data.rds&quot;)

song_data_duration_rank &lt;- mutate(song_data,
                                  duration_min = trackTimeMillis * 10^-3 / 60,
                                  rank_numberic = as.numeric(rank),
                                  top_50 = ifelse(rank_numberic &lt;= 50,
                                                  &quot;Top 50 songs&quot;,
                                                  &quot;Bottom 50 songs&quot;))

country_median_duration = summarise(group_by(song_data_duration_rank, country_name),
                                    median_duration = median(duration_min, na.rm = TRUE))

# Create Visualisation
plot1 &lt;- ggplot() +
  
  geom_boxplot(data = song_data_duration_rank,
               aes(x = duration_min,
                   y = reorder(country_name, duration_min),
                   color = top_50,
                   fill = top_50),
               lwd = 0.5,
               position = &quot;dodge2&quot;) +
  
  geom_point(data = country_median_duration,
             aes(x = median_duration,
                 y = country_name),
             color = &quot;brown&quot;,
             shape = 17,
             size = 4) +
  
  labs(title = &quot;Song Duration from 4 different Apple Music&#39;s Top 100 Daily Playlists&quot;,
       x = &quot;Duration (min)&quot;,
       y = &quot;Playlist Region&quot;,
       caption = &quot;Source: Apple Music\nRetrieved on 29/5/2022&quot;) +
  
  scale_x_continuous(breaks = seq(0, 10, 1)) +

  scale_colour_manual(values = c(&quot;#ff2b0e&quot;, &quot;#5a99ff&quot;)) +
  
  scale_fill_manual(values = c(&quot;#ff9b8e&quot;, &quot;#a6c8ff&quot;)) +
  
  theme(panel.background = element_rect(fill = &quot;#e3eee9&quot;,
                                        colour = &quot;#00a83e&quot;))
  
ggsave(&quot;song_vis.png&quot;, plot = plot1, width = 8, height = 5, units = &quot;in&quot;)

saveRDS(country_median_duration, &quot;data_country_median_duration.RDS&quot;)</code></pre>
<pre class="r"><code># Invoke library
library(tidyverse)
library(ggplot2)

song_data &lt;- readRDS(&quot;song_data.rds&quot;)

nz_song_id &lt;- filter(song_data, country_name == &quot;New Zealand&quot;)$trackId

song_data &lt;- mutate(song_data,
                   similarity = trackId %in% nz_song_id,
                   rank_numberic = as.numeric(rank),
                   top_50 = ifelse(rank_numberic &lt;= 50, &quot;Top 50 songs&quot;, &quot;Bottom 50 songs&quot;))

common_song_nz_ref &lt;- summarise(group_by(song_data, country_name, top_50),
                                similarity = sum(similarity)) %&gt;%
  filter(country_name != &quot;New Zealand&quot;)

# Create Visualisation
plot2 &lt;- ggplot(data = common_song_nz_ref) +
  
  geom_col(aes(x = reorder(country_name, -similarity),
                   y = similarity,
                   color = top_50,
                   fill = top_50),
               lwd = 0.5,
           position = &quot;dodge&quot;) +
  
  labs(title = &quot;Similarity Rate of Apple Music&#39;s Top 100 Daily Playlists\nbetween New Zealand and Other Countries&quot;,
       x = &quot;country&quot;,
       y = &quot;Similarity Rate (%)&quot;,
       caption = &quot;Source: Apple Music\nRetrieved on 29/5/2022&quot;) +
  
  scale_y_continuous(limit = c(0, 20), breaks = seq(0, 20, 5)) +

  scale_colour_manual(values = c(&quot;#ff2b0e&quot;, &quot;#5a99ff&quot;)) +
  
  scale_fill_manual(values = c(&quot;#ff9b8e&quot;, &quot;#a6c8ff&quot;)) +
  
  theme(panel.background = element_rect(fill = &quot;#e3eee9&quot;,
                                        colour = &quot;#00a83e&quot;))
  
ggsave(&quot;song_creation.png&quot;, plot = plot2, width = 8, height = 5, units = &quot;in&quot;)

saveRDS(common_song_nz_ref, &quot;data_common_song_nz_ref.RDS&quot;)</code></pre>
<div id="last-update" class="section level3">
<h3>Last Update</h3>
<p>01/06/2022</p>
</div>
</div>
<div id="back-to-home-page" class="section level2">
<h2>Back to Home Page</h2>
<p><a href="https://220pmc.github.io/portfolio/">Back</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
